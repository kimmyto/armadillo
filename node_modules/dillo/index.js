var io;
var connectSocket;
var thisRoom = 2932;

exports.initGame = function(sio, socket){
    io = sio;
    connectSocket = socket;
    connectSocket.emit('connected', { message: "You are connected!" });
    connectSocket.on('createNewGame', createNewGame);
    connectSocket.on('JoinGame', JoinGame);
    connectSocket.on('pressButton', pressButton);
};

function pressButton(data) {
  io.sockets.in(data.activeRoom).emit('clicked', data);
  console.log("room: "+data.activeRoom);
}

function createNewGame() {
    thisRoom += 47;
    if ( thisRoom > 9999) {
      thisRoom = 100;
    }
    this.emit('gameCreated', {activeRoom: thisRoom, socketId: this.id});
    this.join(thisRoom.toString());
}

function JoinGame(data) {
    data = {
        activeRoom : data.activeRoom
    };
    var sock = this;
    var room = connectSocket.manager.rooms["/" + data.activeRoom];
    if( room !== undefined ){
      data.socketId = sock.id;
      sock.join(data.activeRoom);
      io.sockets.in(data.activeRoom).emit('joined', data);
    }
}
